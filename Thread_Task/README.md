# 쓰레드와 테스크

## 프로세스 개요

최근 운영체제는 여러 프로세스를 동시에 실행할 수 있는 능력을 갖추고 있다. 프로세스 또한 한번에 여러 작업을 할 수 있다. 프로세스란 실행 파일이 실행되어 메모리에 적재된 인스턴스이다. 가령 word.exe가 실행 파일이라면, 이 실행 파일에 담겨 있는 데이터와 코드가 메모리에 적재되어 동작하는 것이 프로세스이다. 프로세스는 반드시 하나 이상의 스레드로 구성되는데, 스레드는 운영체제가 CPU 시간을 할당하는 기본 단위이다.

## 멀티 스레드 장단점

### 장점

1. 첫 번째 장점으로 사용자 대화형 프로그램에서 (콘솔 프로그램과 GUI 프로그램 모두) 멀티 스레드를 이용하면 응답성을 높일 수 있다.

> 예를 들어 단일 스레드를 사용하는 프로그램을 만들었고, 이 프로그램에서 파일 복사만 30분이 걸린다고 하자. 사용자가 파일 복사를 취소하고 싶어도 프로그램은 사용자에게 반응하지 않아서 복사를 취소할 수 없다. 작업관리자를 이용해서 강제로 프로세스를 종료시키지 않는 이상.

따라서 이 프로그램에 사용자와의 대화를 위한 스레드를 하나 더 추가한다면 파일 복사를 하면서도 사용자로부터 명령을 입력받을 수 있다.

2. 두 번째 장점으로는 멀티 프로세스 방식에 비해 멀티 스레드 방식이 자원 공유가 쉽다는 것이다.  
   멀티 프로세스는 GUI가 없는 웹 서버 같은 서버용 어플리케이션이 많이 취하는 구조인데, 프로세스끼리 데이터를 교환하려면 소켓이나 공유 메모리 같은 IPC를 이용해야 한다. 반면에 멀티 스레드 방식에서는 그저 스레드끼리 코드 내의 변수를 같이 사용하는것만으로도 데이터 교환을 할 수 있다.

3. 멀티 프로세스 방식에 비해 멀티 스레드 방식의 좋은 점이 또 하나 있다. 바로 "경제성"이다. 프로세스를 띄우기 위해 메모리와 자원을 할당하는 작업은 ( CPU 사용 시간 등의 ) 비용이 비싼데, 스레드를 띄울 때는 이미 프로세스에 할당된 메모리와 자원을 그대로 사용하므로 메모리와 자원을 할당하는 비용을 지불하지 않아도 된다.

### 단점

1. 멀티 스레드 구조의 소프트웨어는 구현하기가 매우 까다롭다. 테스트 역시 쉽지 않고 멀티 스레드 기반의 소프트웨어 디버깅은 매우 힘들다.

2. 멀티 '프로세스' 기반의 소프트웨어는 여러 개의 자식 프로세스 중 하나에 문제가 생기면 그 자식 프로세스 하나가 죽는 것 이상으로는 영향이 확산되지 않지만, 멀티 '스레드' 기반의 소프트웨어는 자식 스레드 중 하나에 문제가 생기면 전체 프로세스에 영향을 준다.

3. 멀티 스레드 마지막 단점은, 장점이자 단점인데 바로 성능이다. 스레드를 너무 많이 사용하면 오히려 성능이 더 저하된다. 스레드가 CPU를 사용하기 위해서는 작업 간 전환을 해야 하는데, 이 작업 간 전환이 비용을 소모한다. 많은 스레드가 너무 자주 작업 간 전환을 수행하다 보면 애플리케이션이 실제로 일하는 시간에 비해 작업 간 전환에 사용하는 시간이 커지기 때문에 성능이 저하된다.

### 장단점 요약 정리

장점

1. 응답성을 높일 수 있다.
2. 자원 공유가 쉽다.
3. 경제적이다.

단점

1. 구현이 복잡하다.
2. 소프트웨어 안정성을 약화시킬 수 있다.
3. 과용하면 성능이 저하될 수 있다.

## 스레드 시작하기

C#에서 스레드를 쓰기 위해 .NET은 스레드를 제어하는 클래스로 System.Threading.Thread를 제공한다.

1. Thread의 인스턴스를 생성한다. 이때 생성자의 인수로 스레드가 실행할 메소드를 넘긴다.
2. Thread.Start() 메소드를 호출하여 스레드를 시작한다.
3. Thread.Join() 메소드를 호출하여 스레드가 끝날 때까지 기다린다.

